<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.5" />
<title>第２回　NOSQL実機ハンズオン（Riak、HBase、Hibari）</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
<h1>第２回　NOSQL実機ハンズオン（Riak、HBase、Hibari）</h1>
<span id="author">河野達也 Tatsuya Kawano CloudianKK</span><br />
<span id="email"><tt>&lt;<a href="mailto:tkawano@cloudian.com">tkawano@cloudian.com</a>&gt;</tt></span><br />
<span id="revnumber">version v1.0-draft-2,</span>
<span id="revdate">2012年9月25日</span>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p><strong>日本OSS推進フォーラム　若手技術者勉強会</strong></p></div>
</div>
</div>
<h2 id="_1">1. ハンズオンの概要</h2>
<div class="sectionbody">
<div class="paragraph"><p>このハンズオンは <strong>日本OSS推進フォーラム　第２回 若手技術者勉強会</strong>
（2012年9月27日実施）のために作成されました。</p></div>
<div class="paragraph"><p>ここでは、Linuxサーバーを１人１台使用して、異なる特性を持つ、３つの分
散型NOSQL製品を試します。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Basho Riak</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
可用性重視（AP）、コンシステントハッシング
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Apache HBase</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
一貫性重視（CP）、自動シャーディング
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Hibari</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
一貫性重視（CP）、コンシステントハッシング
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>また、２つの性能測定ツールを使用します。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Basho Bench</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
Riak、Hibari向け
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Yahoo! Cloud Serving Benchmark (YCSB)</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
HBase向け
</p>
</li>
<li>
<p>
Cassandra、MongoDB、Redisにも対応
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>ハンズオンを終えると以下のことができるようになります。</p></div>
<div class="ulist"><ul>
<li>
<p>
NOSQLの３つの製品について、ごく基本的な操作ができる
</p>
</li>
<li>
<p>
性能測定ツールの基本操作ができる
</p>
</li>
<li>
<p>
データの分散方法について、「コンシステント・ハッシング」と「自動シャー
  ディング」の違いが説明できる
</p>
</li>
<li>
<p>
CAP定理の中で、可用性重視「AP」のものと、一貫性重視「CP」のものにつ
  いて、違いが説明できる
</p>
</li>
<li>
<p>
ログ構造マージツリー（LSMTree）の特性が説明できる
</p>
</li>
</ul></div>
</div>
<h2 id="_2">2. 環境のセットアップ</h2>
<div class="sectionbody">
<div class="paragraph"><p>ハンズオンの環境は仮想サーバーのディスクイメージとして用意されています。</p></div>
<div class="ulist"><ul>
<li>
<p>
NIIの仮想サーバー環境用
</p>
<div class="ulist"><ul>
<li>
<p>
本日使用します
</p>
</li>
</ul></div>
</li>
<li>
<p>
VirtualBox用ディスクイメージ
</p>
<div class="ulist"><ul>
<li>
<p>
復習用　XX.XGB
</p>
</li>
<li>
<p>
公開期間：2012年10月31日まで
</p>
</li>
<li>
<p>
http://
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>参考までに、今回の環境を１から設定するための手順も用意してあります。
詳細については以下の説明をご覧ください。</p></div>
<div class="paragraph"><p><a href="https://github.com/ossforum-jp-nosql/hands-on/blob/master/README.md">https://github.com/ossforum-jp-nosql/hands-on/blob/master/README.md</a></p></div>
<h3 id="_nii">NIIの仮想サーバーの起動</h3><div style="clear:left"></div>
<div class="paragraph"><p>今回はマシンタイプに「c1.medium」を使用します。</p></div>
<div class="ulist"><ul>
<li>
<p>
CPU：Intel Xeon E5530 @2.40GHz  x １コア
</p>
</li>
<li>
<p>
メモリ：3 GB
</p>
</li>
<li>
<p>
起動ディスク：10 GB
</p>
</li>
</ul></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h3 id="_">仮想サーバーにディスクボリュームを追加</h3><div style="clear:left"></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h3 id="_ssh">仮想サーバーにsshでログイン</h3><div style="clear:left"></div>
<div class="paragraph"><p>（シンクライアントはWindows？？）</p></div>
<div class="paragraph"><p>●●●を立ち上げ、sshで接続します。</p></div>
<div class="paragraph"><p><strong>TODO</strong> パスワード接続は可能？　それともsshキーを用意する？</p></div>
<div class="ulist"><ul>
<li>
<p>
ユーザー名： ossforum
</p>
</li>
<li>
<p>
パスワード： nosql2
</p>
</li>
</ul></div>
<div class="paragraph"><p>ログインに成功したら、パスワードを変更してください。これにより、他の受
講生があなたのサーバーに間違ってログインしてしまうことが防げます。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ passwd □
<span style="color: #990000">(</span>current<span style="color: #990000">)</span> UNIX password<span style="color: #990000">:</span> （現在のパスワード） □
New password<span style="color: #990000">:</span> （新しいパスワード） □
Retype new password<span style="color: #990000">:</span> （新しいパスワードを再入力） □</tt></pre></div></div>
<h3 id="__2">製品のバージョン</h3><div style="clear:left"></div>
<div class="paragraph"><p>仮想サーバーにはハンズオンで使用するNOSQLとツールがすでに導入されてい
ます。各製品のバージョンは以下の通りです。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>NOSQL</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
Basho Riak 1.2
</p>
</li>
<li>
<p>
Apache HBase 0.92.1-cdh4.0.1
</p>
<div class="ulist"><ul>
<li>
<p>
Cloudera社のCDHディストリビューションを使用
</p>
</li>
</ul></div>
</li>
<li>
<p>
Hibari 0.1.9
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>性能測定ツール</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
Basho Bench X.XXX
</p>
</li>
<li>
<p>
YCSB X.XXX
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Erlang、Java実行環境</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
Erlang/OTP&#8201;&#8212;&#8201;R15B02
</p>
<div class="ulist"><ul>
<li>
<p>
Riak、Hibari、Basho Benchで使用
</p>
</li>
</ul></div>
</li>
<li>
<p>
Java&#8201;&#8212;&#8201;Oracle JDK 1.6 update 31
</p>
<div class="ulist"><ul>
<li>
<p>
HBaseとYCSBで使用
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
<strong>基本ソフトウェア</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
Linux&#8201;&#8212;&#8201;CentOS 6.3　64ビットバージョン
</p>
</li>
</ul></div>
</li>
</ul></div>
<h3 id="__3">ディレクトリ構成</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>/home/
    ossforum/
        basho_bench/
        bin/
        erlang/

        hands-on/
            README.md
            bin/　　　          ← ハンズオンで使用するスクリプトが含まれている
            conf-bb/           ← Basho Benchのワークロード設定ファイル
            conf-ycsb/         ← YCSBのワークロード設定ファイル
            docs/
                hands-on.txt
                hands-on.html  ← このドキュメント
                setup.txt
                setup.html     ← 環境を一からセットアップするときの手順
            lib/
            logs-hbase/        ← HBaseのログディレクトリ（シンボリックリンク）
            results-bb/        ← Basho Benchの結果（シンボリックリンク）
            results-ycsb/      ← YCSBの結果（シンボリックリンク）

        hibari/

        Public/
            web/               ← Webサーバーで公開されます。Bascho Benchの結果が入ります

        riak/
        riak-client-erlang/
        ycsb/
/opt/ ... *TODO*</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Linuxでテキストファイルの内容を表示、編集する</div>スクリプトのようなテキストファイルの内容を表示するには、 <tt>less</tt> コマン
ドを使用します。また、テキストファイルの内容を編集するには、 <tt>nano</tt> コ
マンド（または vi、emacs）を使用します。ファイルの編集が終わったら、
<tt>Control</tt> キーと <tt>x</tt> キーを同時に押して保存します。</td>
</tr></table>
</div>
</div>
<h2 id="_3_basho_riak">3. Basho Riakの基本操作</h2>
<div class="sectionbody">
<h3 id="_riak">Riakの特徴</h3><div style="clear:left"></div>
<div class="ulist"><ul>
<li>
<p>
コンシステント・ハッシングによるデータ分散
</p>
</li>
<li>
<p>
可用性を優先（AP）
</p>
</li>
<li>
<p>
キー・バリュー型
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>前回の訂正：</strong> 前回「ドキュメント型」と説明しましたが、「キー・バ
    リュー型」に分類するのが適切なようです
</p>
</li>
</ul></div>
</li>
<li>
<p>
豊富な機能
</p>
<div class="ulist"><ul>
<li>
<p>
二次インデックス
</p>
</li>
<li>
<p>
全文検索（日本語の検索が可能かは未確認）
</p>
</li>
<li>
<p>
Map Reduce（JavaScript、Erlang）
</p>
</li>
</ul></div>
</li>
<li>
<p>
高い安定性
</p>
</li>
</ul></div>
<h3 id="_riak_2">Riakの起動と停止</h3><div style="clear:left"></div>
<div class="paragraph"><p>今回は学習のために、１台のLinux仮想サーバー上で複数のRiakメンバーノー
ドを動かします。実際の運用では１台のサーバーにつき１つのRiakメンバーノー
ドを稼働させます。（構成図）</p></div>
<div class="paragraph"><p>今回用意したスクリプトを使ってRiakクラスターを起動します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>（□で改行）
$ riak-start-ossforum<span style="color: #990000">.</span>sh □
riak1 started
riak2 started
<span style="color: #990000">...</span>（略）

（起動後の確認。pongと帰ってくればOK）
$ riak-ping-ossforum<span style="color: #990000">.</span>sh □
riak1 <span style="color: #990000">...</span> pong
riak2 <span style="color: #990000">...</span> pong
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
<h3 id="_riak_api">RiakのクライアントAPI</h3><div style="clear:left"></div>
<div class="paragraph"><p>Riakでは３種類のクライアントAPIが用意されています。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>HTTP REST</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
プログラム言語に依存せずにアクセスできる
</p>
</li>
<li>
<p>
ウェブブラウザーで表示できる
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Protocol Buffers</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
Protocol BuffersはGoogle社が開発した異言語間の&#8230; <strong>TODO</strong>
</p>
</li>
<li>
<p>
様々なプログラミング言語からアクセスできる
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Erlangネイティブクライアント</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
プログラミング言語「Erlang」専用のクライアント
</p>
</li>
<li>
<p>
Riak本体はErlangで書かれています
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>今回はErlang版のProtocol Buffersクライアントを使用します。</p></div>
<h3 id="_protocol_buffers_erlang">Protocol Buffersでアクセス（Erlang）</h3><div style="clear:left"></div>
<h4 id="_riak_3">Riakに接続</h4>
<div class="paragraph"><p>Erlangのシェルを立ち上げ、Riakに接続します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ erl-riak-ossforum<span style="color: #990000">.</span>sh □
Erlang R15B02 <span style="color: #990000">(</span>erts-<span style="color: #993399">5.9</span><span style="color: #990000">.</span><span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #0000FF">source</span></span><span style="color: #990000">]</span> <span style="color: #990000">[</span><span style="color: #993399">64</span>-bit<span style="color: #990000">]</span> <span style="color: #990000">[</span>smp<span style="color: #990000">:</span><span style="color: #993399">4</span><span style="color: #990000">:</span><span style="color: #993399">4</span><span style="color: #990000">]</span> <span style="color: #990000">[</span>async-threads<span style="color: #990000">:</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">[</span>hipe<span style="color: #990000">]</span> <span style="color: #990000">[</span>kernel-poll<span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">]</span>

Eshell V5<span style="color: #990000">.</span><span style="color: #993399">9.2</span>  <span style="color: #990000">(</span>abort with <span style="color: #990000">^</span>G<span style="color: #990000">)</span>
<span style="color: #993399">1</span><span style="color: #990000">&gt;</span></tt></pre></div></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="paragraph"><p>Erlangシェルのプロンプト「1&gt;」は、以下、「&gt;」で示します。</p></div>
<h4 id="__4">インデックス付きの、キー・バリューを格納</h4>
<div class="paragraph"><p>「employee（社員）」というバケットに、１つ目のキー・バリューを格納しま
しょう。後で検索がしやすいよう、インデックス（索引）に「age_int（年齢）」
と「state_bin（居住している州）」を登録します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">%% パーセントマークから改行まではコメントです</span></span>

<span style="font-style: italic"><span style="color: #9A1900">%% Riakのプロトコルバッファのポートに接続。</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% デフォルトポートは8087ですが、今回は１台のサーバーに複数のメンバーノー</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% ドを稼働させるため、デフォルトから変更し、メンバーノード毎に違うポー</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% トを割り当てています）</span></span>

<span style="color: #990000">&gt;</span> {ok, Pid} <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:start_link</span></span>(<span style="color: #FF0000">"127.0.0.1"</span>, <span style="color: #993399">8091</span>)<span style="color: #990000">.</span> □
{ok,<span style="color: #990000">&lt;</span><span style="color: #993399">0.33</span><span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">&gt;</span>}


<span style="font-style: italic"><span style="color: #9A1900">%% キーバリューを作成。</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% バケット：employee、キー：jermy、バリュー：engineer。</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% まだこの時点ではRiakへ送信されていません。最後のput操作で格納されます）</span></span>

<span style="color: #990000">&gt;</span> Obj1a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">riakc_obj:new</span></span>(<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"jeremy"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"engineer"</span><span style="color: #990000">&gt;&gt;</span>)<span style="color: #990000">.</span> □
{riakc<span style="color: #990000">_</span>obj,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"jeremy"</span><span style="color: #990000">&gt;&gt;</span>,undefined,[],
           undefined,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"engineer"</span><span style="color: #990000">&gt;&gt;</span>}


<span style="font-style: italic"><span style="color: #9A1900">%% １つ目のキー・バリューに索引情報を追加。</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% age_intは年齢を整数型で表したもの。</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% state_binは居住している州をバイナリー型で表したもの）</span></span>

<span style="color: #990000">&gt;</span> MetaData1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">dict:store</span></span>(<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"index"</span><span style="color: #990000">&gt;&gt;</span>, [{<span style="color: #FF0000">"age_int"</span>, <span style="color: #FF0000">"23"</span>}, {<span style="color: #FF0000">"state_bin"</span>, <span style="color: #FF0000">"CA"</span>}], <span style="font-weight: bold"><span style="color: #000000">dict:new</span></span>())<span style="color: #990000">.</span> □
{dict,<span style="color: #993399">1</span>,<span style="color: #993399">16</span>,<span style="color: #993399">16</span>,<span style="color: #993399">8</span>,<span style="color: #993399">80</span>,<span style="color: #993399">48</span>,
      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
      {{[],[],[],[],[],[],[],[],[],[],[],
        [[<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"index"</span><span style="color: #990000">&gt;&gt;</span>,{<span style="color: #FF0000">"age_int"</span>,<span style="color: #FF0000">"23"</span>},{<span style="color: #FF0000">"state_bin"</span>,<span style="color: #FF0000">"CA"</span>}]],
        [],[],[],[]}}}

<span style="color: #990000">&gt;</span> Obj1b <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">riakc_obj:update_metadata</span></span>(Obj1a, MetaData1)<span style="color: #990000">.</span> □
{riakc<span style="color: #990000">_</span>obj,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"jeremy"</span><span style="color: #990000">&gt;&gt;</span>,undefined,[],
           {dict,<span style="color: #993399">1</span>,<span style="color: #993399">16</span>,<span style="color: #993399">16</span>,<span style="color: #993399">8</span>,<span style="color: #993399">80</span>,<span style="color: #993399">48</span>,
                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],<span style="color: #990000">...</span>},
                 {{[],[],[],[],[],[],[],[],[],[],[],[[<span style="color: #990000">...</span>]],[],<span style="color: #990000">...</span>}}},
           <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"engineer"</span><span style="color: #990000">&gt;&gt;</span>}

<span style="font-style: italic"><span style="color: #9A1900">%% １つ目のキー・バリュー（Obj1bの方）をRiakに格納</span></span>

<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:put</span></span>(Pid, Obj1b)<span style="color: #990000">.</span> □
ok</tt></pre></div></div>
<div class="paragraph"><p>２つ目のオブジェクトを格納します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;</span> Obj2a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">riakc_obj:new</span></span>(<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"scientist"</span><span style="color: #990000">&gt;&gt;</span>)<span style="color: #990000">.</span> □
{riakc<span style="color: #990000">_</span>obj,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>,undefined,[],
           undefined,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"scientist"</span><span style="color: #990000">&gt;&gt;</span>}

<span style="color: #990000">&gt;</span> MetaData2 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">dict:store</span></span>(<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"index"</span><span style="color: #990000">&gt;&gt;</span>, [{<span style="color: #FF0000">"age_int"</span>, <span style="color: #FF0000">"29"</span>}, {<span style="color: #FF0000">"state_bin"</span>, <span style="color: #FF0000">"CA"</span>}], <span style="font-weight: bold"><span style="color: #000000">dict:new</span></span>())<span style="color: #990000">.</span> □
{dict,<span style="color: #993399">1</span>,<span style="color: #993399">16</span>,<span style="color: #993399">16</span>,<span style="color: #993399">8</span>,<span style="color: #993399">80</span>,<span style="color: #993399">48</span>,
      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
      {{[],[],[],[],[],[],[],[],[],[],[],
        [[<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"index"</span><span style="color: #990000">&gt;&gt;</span>,{<span style="color: #FF0000">"age_int"</span>,<span style="color: #FF0000">"32"</span>},{<span style="color: #FF0000">"state_bin"</span>,<span style="color: #FF0000">"CA"</span>}]],
        [],[],[],[]}}}

<span style="color: #990000">&gt;</span> Obj2b <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">riakc_obj:update_metadata</span></span>(Obj2a, MetaData2)<span style="color: #990000">.</span> □
{riakc<span style="color: #990000">_</span>obj,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>,undefined,[],
           {dict,<span style="color: #993399">1</span>,<span style="color: #993399">16</span>,<span style="color: #993399">16</span>,<span style="color: #993399">8</span>,<span style="color: #993399">80</span>,<span style="color: #993399">48</span>,
                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],<span style="color: #990000">...</span>},
                 {{[],[],[],[],[],[],[],[],[],[],[],[[<span style="color: #990000">...</span>]],[],<span style="color: #990000">...</span>}}},
           <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"scientist"</span><span style="color: #990000">&gt;&gt;</span>}

<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:put</span></span>(Pid, Obj2b)<span style="color: #990000">.</span> □
ok</tt></pre></div></div>
<h4 id="__5">キーを指定してキー・バリューを取り出し。</h4>
<div class="paragraph"><p>キーを指定してキー・バリューを取り出します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:get</span></span>(Pid, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>)<span style="color: #990000">.</span>
{ok,{riakc<span style="color: #990000">_</span>obj,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>,
               <span style="color: #990000">&lt;&lt;</span><span style="color: #993399">107</span>,<span style="color: #993399">206</span>,<span style="color: #993399">97</span>,<span style="color: #993399">96</span>,<span style="color: #993399">96</span>,<span style="color: #993399">96</span>,<span style="color: #993399">204</span>,<span style="color: #993399">96</span>,<span style="color: #993399">202</span>,<span style="color: #993399">5</span>,<span style="color: #993399">82</span>,<span style="color: #993399">28</span>,<span style="color: #993399">7</span>,<span style="color: #993399">47</span>,<span style="color: #993399">197</span>,<span style="color: #993399">115</span>,<span style="color: #993399">6</span>,
                 <span style="color: #993399">196</span>,<span style="color: #993399">127</span>,<span style="color: #993399">126</span>,<span style="color: #993399">158</span>,<span style="color: #993399">193</span>,<span style="color: #993399">148</span>,<span style="color: #990000">...&gt;&gt;</span>,
               [{{dict,<span style="color: #993399">3</span>,<span style="color: #993399">16</span>,<span style="color: #993399">16</span>,<span style="color: #993399">8</span>,<span style="color: #993399">80</span>,<span style="color: #993399">48</span>,
                       {[],[],[],[],[],[],[],[],[],[],[],[],<span style="color: #990000">...</span>},
                       {{[],[],[],[],[],[],[],[],[],[],<span style="color: #990000">...</span>}}},
                 <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"scientist"</span><span style="color: #990000">&gt;&gt;</span>}],
               undefined,undefined}}

<span style="font-style: italic"><span style="color: #9A1900">%% キーが存在しないときは「notfound」になります。</span></span>
<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:get</span></span>(Pid, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"gary"</span><span style="color: #990000">&gt;&gt;</span>)<span style="color: #990000">.</span>
{error,notfound}</tt></pre></div></div>
<h4 id="__6">インデックスを用いた検索</h4>
<div class="paragraph"><p>インデックス情報を用いてキー・バリューを検索しましょう。 <tt>get_index</tt>
では指定した条件に合致するキー・バリューを見つけて、一連のキーを返しま
す。</p></div>
<div class="paragraph"><p>なおこの機能（二次インデックス）は、RiakのストレージエンジンにLevelDB
を選択した時のみ利用できます。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">%% employeeバケットの中で、state_binが「CA」のもの</span></span>
<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:get_index</span></span>(Pid, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #FF0000">"state_bin"</span>, <span style="color: #FF0000">"CA"</span>)<span style="color: #990000">.</span>
{ok,[<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"jeremy"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>]}

<span style="font-style: italic"><span style="color: #9A1900">%% employeeバケットの中で、state_binが「NY」のもの</span></span>
<span style="font-style: italic"><span style="color: #9A1900">%% 該当するキー・バリューがない場合は、空のリストが返されます）</span></span>
<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:get_index</span></span>(Pid, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #FF0000">"state_bin"</span>, <span style="color: #FF0000">"NY"</span>)<span style="color: #990000">.</span>
{ok,[]}

<span style="font-style: italic"><span style="color: #9A1900">%% employeeバケットの中で、age_intが「23」のもの</span></span>
<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:get_index</span></span>(Pid, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #FF0000">"age_int"</span>, <span style="color: #FF0000">"23"</span>)<span style="color: #990000">.</span>
{ok,[<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"jeremy"</span><span style="color: #990000">&gt;&gt;</span>]}

<span style="font-style: italic"><span style="color: #9A1900">%% employeeバケットの中で、age_intが「20」以上、「29」以下のもの</span></span>
<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">riakc_pb_socket:get_index</span></span>(Pid, <span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"employee"</span><span style="color: #990000">&gt;&gt;</span>, <span style="color: #FF0000">"age_int"</span>, <span style="color: #FF0000">"20"</span>, <span style="color: #FF0000">"29"</span>)<span style="color: #990000">.</span>
{ok,[<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"helena"</span><span style="color: #990000">&gt;&gt;</span>,<span style="color: #990000">&lt;&lt;</span><span style="color: #FF0000">"jeremy"</span><span style="color: #990000">&gt;&gt;</span>]}
</tt></pre></div></div>
<h4 id="_map_reduce">Map Reduceによる集計</h4>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="paragraph"><p><strong>TODO</strong> （erlシェルから抜ける方法）</p></div>
</div>
<h2 id="_4">4. データ分散について：コンシステント・ハッシング（その１）</h2>
<div class="sectionbody">
<div class="paragraph"><p>Riakを用いてコンシステント・ハッシングの基本を確認します。</p></div>
<div class="ulist"><ul>
<li>
<p>
Ringの状態
</p>
</li>
<li>
<p>
キーとハッシュ関数
</p>
</li>
<li>
<p>
メンバーノードの追加とデータの偏り
</p>
</li>
</ul></div>
<div class="exampleblock">
<div class="title">問題 4-1. クラスター構成の確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>このRiakクラスターには、いくつの <strong>メンバーノード</strong> がありますか？　以下
のコマンドで調べてください。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-admin member-status □</tt></pre></div></div>
<div class="listingblock">
<div class="title">サンプル出力</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt> <span style="color: #990000">=================================</span> Membership <span style="color: #990000">==================================</span>
 Status     Ring    Pending    Node
 -------------------------------------------------------------------------------
 valid      <span style="color: #993399">34.4</span><span style="color: #990000">%</span>      --      <span style="color: #FF0000">'riak1@127.0.0.1'</span>
 valid      <span style="color: #993399">32.8</span><span style="color: #990000">%</span>      --      <span style="color: #FF0000">'riak2@127.0.0.1'</span>
 valid      <span style="color: #993399">32.8</span><span style="color: #990000">%</span>      --      <span style="color: #FF0000">'riak3@127.0.0.1'</span>
 -------------------------------------------------------------------------------
 Valid<span style="color: #990000">:</span><span style="color: #993399">3</span> <span style="color: #990000">/</span> Leaving<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Exiting<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Joining<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Down<span style="color: #990000">:</span><span style="color: #993399">0</span></tt></pre></div></div>
<div class="paragraph"><p>この例では３個のメンバーノードがあります。（ハンズオン用の構成はこれとは異なります）</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　　　　　　　個</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 4-2. リングサイズの確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>このRiakクラスターには、いくつの <strong>仮想ノード（v-node）</strong> がありますか？　
以下のコマンドで調べてください。<br /></p></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　　　　　　　個</p></div>
</div></div>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">リングのサイズについて</div>今回はリングについて理解しやすいよう、リングサイズを小さく設定していま
す。しかし、この設定ではデータの偏りが起こりやすくなってしまいます。
Riakを業務で使用する際は、この値を大きく（数十〜数百に）設定してくださ
い。</td>
</tr></table>
</div>
<div class="exampleblock">
<div class="title">問題 4-3. バケット名とキーからハッシュ値を算出</div>
<div class="exampleblock-content">
<div class="paragraph"><p>Riakではバケット名とキーからハッシュ値を算出します。今回、そのハッシュ
値をRiakクラスターに問い合わせるスクリプトを用意しました。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-keyhash-ossforum<span style="color: #990000">.</span>escripts バケット名 キー □
バケット名<span style="color: #990000">/</span>キー<span style="color: #990000">:</span> <span style="color: #993399">1105587885383052304283168935552548319333692233768</span></tt></pre></div></div>
<div class="paragraph"><p>このスクリプトを使って、同じバケット「 <strong>b1</strong> 」に格納されるよく似た２つ
のキー「 <strong>key1</strong> 」と「 <strong>key2</strong> 」のハッシュ値を求めてください。<br /></p></div>
<div class="paragraph"><p>この２つのハッシュ値は似ていますか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え： 1. 似ている　　2. 全く異なる</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 4-4. キーを格納するノードを算出</div>
<div class="exampleblock-content">
<div class="paragraph"><p>データがどのノードに格納されるか調べましょう。今回、以下のスクリプトを
用意しました。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-preflist-ossforum<span style="color: #990000">.</span>escripts バケット名 キー □
バケット名<span style="color: #990000">/</span>キー<span style="color: #990000">:</span> <span style="color: #993399">1105587885383052304283168935552548319333692233768</span>

Targets<span style="color: #990000">:</span>
<span style="color: #990000">[</span>{<span style="color: #993399">1118962191081472546749696200048404186924073353216</span><span style="color: #990000">,</span><span style="color: #FF0000">'riak2@127.0.0.1'</span>}<span style="color: #990000">,</span>
 {<span style="color: #993399">1141798154164767904846628775559596109106197299200</span><span style="color: #990000">,</span><span style="color: #FF0000">'riak3@127.0.0.1'</span>}<span style="color: #990000">,</span>
 {<span style="color: #993399">1164634117248063262943561351070788031288321245184</span><span style="color: #990000">,</span><span style="color: #FF0000">'riak1@127.0.0.1'</span>}<span style="color: #990000">]</span>

Fallbacks<span style="color: #990000">:</span>
<span style="color: #990000">[</span>{<span style="color: #993399">1187470080331358621040493926581979953470445191168</span><span style="color: #990000">,</span><span style="color: #FF0000">'riak1@127.0.0.1'</span>}<span style="color: #990000">,</span>
 {<span style="color: #993399">1210306043414653979137426502093171875652569137152</span><span style="color: #990000">,</span><span style="color: #FF0000">'riak2@127.0.0.1'</span>}<span style="color: #990000">,</span>
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
<div class="paragraph"><p>複製数が３の場合は、上から数えて３つ目までの仮想ノードに格納されます。
キー「 <strong>key1</strong> 」と「 <strong>key2</strong> 」をバケット「 <strong>b1</strong> 」に格納した場合、どの
メンバーノードに格納されるか調べて下さい。</p></div>
<div class="paragraph"><p>注意：メンバーノードには「<a href="mailto:riakN@127.0.0.1">riakN@127.0.0.1</a> 」のような名前がついています。
（Nは数字）　riakNの形で答えてください。</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：</p></div>
<div class="paragraph"><p>b1 key1　(1) ＿＿＿＿＿＿＿　(2) ＿＿＿＿＿＿＿　(3) ＿＿＿＿＿＿＿</p></div>
<div class="paragraph"><p>b1 key2　(1) ＿＿＿＿＿＿＿　(2) ＿＿＿＿＿＿＿　(3) ＿＿＿＿＿＿＿</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 4-5. ２つ以上の複製が１つのメンバーノードに格納されるケース</div>
<div class="exampleblock-content">
<div class="paragraph"><p>Riakではそれぞれの仮想ノードがメンバーノードにランダムに割り当てられま
す。その結果、データの３つの複製が２つのメンバーノードにしか格納されな
いことがあります。その場合、一方のメンバーノードには１つの複製が格納さ
れ、もう一方のメンバーノードには２つの複製が格納されます。<br /></p></div>
<div class="paragraph"><p>キーを自由に変えて、そのようなケースが起こることを確認してください。</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>バケット　　キー　　　　　　　　ノード</p></div>
<div class="paragraph"><p>b1　　　　　＿＿＿＿＿＿＿＿　　(1) ＿＿＿＿＿＿＿　(2) ＿＿＿＿＿＿＿　(3) ＿＿＿＿＿＿＿</p></div>
<div class="paragraph"><p>b1　　　　　＿＿＿＿＿＿＿＿　　(1) ＿＿＿＿＿＿＿　(2) ＿＿＿＿＿＿＿　(3) ＿＿＿＿＿＿＿</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 4-6. ２つ以上の複製を１つのメンバーノードに置かない方法</div>
<div class="exampleblock-content">
<div class="paragraph"><p>仮にあなたがRiakクラスターを自由に設計できる立場にいたとしたら、問題
2-5のケースをどうやって <strong>起こりにくく</strong> しますか？　あなたは以下の要素
を決めることができます。</p></div>
<div class="ulist"><ul>
<li>
<p>
データの複製の数
</p>
</li>
<li>
<p>
メンバーノードの数（サーバーの台数）
</p>
</li>
<li>
<p>
リングのサイズ（仮想ノードの数）
</p>
</li>
<li>
<p>
バケットの名前やキー
</p>
</li>
</ul></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 4-7. メンバーノードの追加とデータ分散</div>
<div class="exampleblock-content">
<div class="paragraph"><p>Riakは他の多くのNOSQLと同様に、サービスの稼働中にメンバーノードを追加
したり、取り除いたりできます。現在のクラスターにメンバーノードを追加し
ましょう。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #009900">$RIAK_HOME</span>/riak<span style="color: #993399">4</span>/bin/riak-admin cluster join riak1@<span style="color: #993399">127.0</span><span style="color: #990000">.</span><span style="color: #993399">0.1</span> □
$ <span style="color: #009900">$RIAK_HOME</span>/riak<span style="color: #993399">4</span>/bin/riak-admin cluster plan □
$ <span style="color: #009900">$RIAK_HOME</span>/riak<span style="color: #993399">4</span>/bin/riak-admin cluster commit □</tt></pre></div></div>
<div class="paragraph"><p>仮想ノードの分散状況を確認します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-admin member-status □</tt></pre></div></div>
<div class="paragraph"><p>Ringの割合は各ノードで均等になっていますか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え： 1. なっている　　2. なっていない</p></div>
</div></div>
</div></div>
<h3 id="_riak_4">Riakの停止</h3><div style="clear:left"></div>
<div class="paragraph"><p>作業が終わったらRiakを停止します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-stop-ossforum<span style="color: #990000">.</span>sh □
ok
ok
<span style="color: #990000">...</span>（略）
riak2 stopped
riak1 stopped

$ riak-ping-ossforum<span style="color: #990000">.</span>sh □
riak1 <span style="color: #990000">...</span> Node <span style="color: #FF0000">'riak1@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
node riak1 ping failed
riak2 <span style="color: #990000">...</span> Node <span style="color: #FF0000">'riak2@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
node riak2 ping failed
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
</div>
<h2 id="_5_riak_cassandra_hibari">5. 講義：データ分散について、Riak、Cassandra、Hibariを比較</h2>
<div class="sectionbody">
<div class="paragraph"><p>データ分散についてRiakと同様にコンシステント・ハッシングを採用した
CassandraやHibariの設計を比較します。それぞれに長所と短所があります。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Basho Riak</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
2009年に最初のリリース
</p>
</li>
<li>
<p>
Amazon Dynamoの設計を参考にした
</p>
</li>
<li>
<p>
リングを仮想ノードで分割し、メンバーノードにランダムに配置
</p>
<div class="ulist"><ul>
<li>
<p>
メンバーノードの追加時のリバランスが自動的に行われる
</p>
</li>
<li>
<p>
複製の配置が偏ることがある
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Apache Cassandra</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
2008年に最初のリリース
</p>
</li>
<li>
<p>
データ分散はAmazon Dynamoを参考にし、データモデルはGoogle Bigtable
    を参考にした
</p>
</li>
<li>
<p>
リングをメンバーノードで分割
</p>
<div class="ulist"><ul>
<li>
<p>
メンバーノード追加時後のリバランスが面倒
</p>
</li>
<li>
<p>
複製の配置が偏らない
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Hibari</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
2004年ごろから開発開始。50ノード超の商用利用を経て2010年にオープン
    ソース化
</p>
</li>
<li>
<p>
チェインレプリケーション論文を参考に設計
</p>
</li>
<li>
<p>
リングをチェインに分割して、メンバーノードにまたがって配置
</p>
<div class="ulist"><ul>
<li>
<p>
メンバーノードの追加時に手動でチェインを設定する
</p>
</li>
<li>
<p>
複製の配置が偏らない
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</div>
<h2 id="_6_hibari">6. Hibariの基本操作</h2>
<div class="sectionbody">
<h3 id="_hibari">Hibariの特徴</h3><div style="clear:left"></div>
<div class="ulist"><ul>
<li>
<p>
コンシステント・ハッシングによるデータ分散
</p>
</li>
<li>
<p>
整合性を優先（CP）
</p>
<div class="ulist"><ul>
<li>
<p>
チェインレプリケーションによる高速性
</p>
</li>
<li>
<p>
マイクロトランザクション、CAS操作
</p>
</li>
</ul></div>
</li>
<li>
<p>
キー・バリュー型
</p>
</li>
<li>
<p>
軽快な動作と高い安定性
</p>
</li>
</ul></div>
<h3 id="_hibari_2">Hibariの起動と停止</h3><div style="clear:left"></div>
<div class="paragraph"><p>今回は学習のために、１台のLinux仮想サーバー上で複数のHibariメンバーノー
ド（「ブリックサーバー」と呼びます）を動かします。実際の運用では１台の
サーバーにつき１つのブリックサーバーを稼働させます。（構成図）</p></div>
<div class="paragraph"><p>今回用意したスクリプトを使ってHibariクラスターを起動します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hibari-start-ossforum<span style="color: #990000">.</span>sh □
hibari1 started
hibari2 started
<span style="color: #990000">...</span>（略）

$ hibari-ping-ossforum<span style="color: #990000">.</span>sh □
hibari1 <span style="color: #990000">...</span> pong
hibari2 <span style="color: #990000">...</span> pong
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
<h3 id="_hibari_api">HibariのクライアントAPI</h3><div style="clear:left"></div>
<div class="paragraph"><p>Hibariでは３種類のクライアントAPIが用意されています。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Erlangネイティブクライアント</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
プログラミング言語「Erlang」専用のクライアント
</p>
</li>
<li>
<p>
Hibari本体はErlangで書かれています
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Thrift</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
様々なプログラミング言語からアクセスできる
</p>
</li>
<li>
<p>
現状、一部の機能しか利用できない
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>JSON-RPC</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
様々なプログラミング言語からアクセスできる
</p>
</li>
<li>
<p>
現状、一部の機能しか利用できない
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>今回はErlangネイティブクライアントを使用します。</p></div>
<h3 id="_erlang">Erlangネイティブクライアントでアクセス</h3><div style="clear:left"></div>
<h4 id="__7">テーブルを作成</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hibari-create-tables-ossforum<span style="color: #990000">.</span>sh □
ok
ok
Table basho_bench_test_simple created
ok
Table basho_bench_test_sequential created
ok
Table basho_bench_test_random created</tt></pre></div></div>
<div class="paragraph"><p>このスクリプトにより３つのテーブルが作られました。</p></div>
<h4 id="_hibari_3">Hibariに接続</h4>
<div class="listingblock">
<div class="content">
<pre><tt>$ erl-hibari-ossforum.sh □
Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.9.2  (abort with ^G)
1&gt;</tt></pre>
</div></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="paragraph"><p>以下、プロンプト「1&gt;」は「&gt;」で示します。</p></div>
<h4 id="__8">メタデータ付きの、キーバリューを格納</h4>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h4 id="__9">キーの区切り文字とレンジスキャン</h4>
<div class="paragraph"><p><strong>TODO</strong></p></div>
</div>
<h2 id="_7">7. データ分散について：コンシステント・ハッシング（その２）</h2>
<div class="sectionbody">
<div class="paragraph"><p>Hibariと性能測定ツールのBasho Benchを用いて、データの分散状況を観察し
ます。</p></div>
<div class="ulist"><ul>
<li>
<p>
チェインの確認
</p>
</li>
<li>
<p>
Basho Benchの使いかた
</p>
</li>
<li>
<p>
キーの採番方法とデータ分散の関係
</p>
</li>
</ul></div>
<div class="paragraph"><p>なお、RiakやCassandraもデータの分散に関しては近い特性を持ちます。</p></div>
<div class="exampleblock">
<div class="title">問題 7-1. クラスター構成の確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>このHibariクラスターには、いくつの <strong>ブリックサーバー</strong> が使われていますか？　
Web UIで調べてください。</p></div>
<div class="paragraph"><p><a href="http://仮想サーバーのアドレス:23080/">http://仮想サーバーのアドレス:23080/</a></p></div>
<div class="paragraph"><p>ページの下の方にある「Nodes」と書かれた表を見ます。</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　　　　　　　個</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 7-2. チェインの確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>このHibariクラスターのテーブル「 <strong>basho_bench_test_simple</strong> 」には、何
本の <strong>チェイン</strong> がありますか？　Web UIで調べてください。</p></div>
<div class="paragraph"><p><a href="http://仮想サーバーのアドレス:23080/table?name=basho_bench_test_simple">http://仮想サーバーのアドレス:23080/table?name=basho_bench_test_simple</a></p></div>
<div class="paragraph"><p>Chainsの表の「Name」の欄を見てください。「basho_bench_test_simple_ch1」
の「&#8230;_ch1」を見ると、１からいくつまでありますか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　　　　　　　本</p></div>
</div></div>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">運用環境でのチェイン数について</div><strong>TODO</strong></td>
</tr></table>
</div>
<div class="exampleblock">
<div class="title">問題 7-3. Basho Benchの実行</div>
<div class="exampleblock-content">
<div class="paragraph"><p>Basho Benchを実行しましょう。以下のコマンドを入力します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd <span style="color: #990000">~</span>/hands-on □
$ basho_bench conf-bb/hibari-simple<span style="color: #990000">.</span>config□
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>debug<span style="color: #990000">]</span> Lager installed handler lager_console_backend into lager_event
<span style="color: #990000">...</span>（省略）
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Starting <span style="color: #993399">100.0</span> ms/req fixed rate worker<span style="color: #990000">:</span> <span style="color: #990000">&lt;</span> <span style="color: #990000">...</span> <span style="color: #990000">&gt;</span>
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Starting <span style="color: #993399">100.0</span> ms/req fixed rate worker<span style="color: #990000">:</span> <span style="color: #990000">&lt;</span> <span style="color: #990000">...</span> <span style="color: #990000">&gt;</span>
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Starting <span style="color: #993399">100.0</span> ms/req fixed rate worker<span style="color: #990000">:</span> <span style="color: #990000">&lt;</span> <span style="color: #990000">...</span> <span style="color: #990000">&gt;</span>
<span style="color: #990000">...</span>（省略）
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Application basho_bench started on node <span style="color: #FF0000">'basho_bench@127.0.0.1'</span>
<span style="color: #990000">...</span>（省略）

<span style="color: #990000">...</span>（１分後）
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Total Errors<span style="color: #990000">:</span>
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span>   {{put<span style="color: #990000">,</span>put}<span style="color: #990000">,</span>{txn_fail<span style="color: #990000">,[</span>{<span style="color: #993399">0</span><span style="color: #990000">,</span>brick_not_available}<span style="color: #990000">]</span>}}<span style="color: #990000">:</span> <span style="color: #993399">1</span>
（または）
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> No Errors<span style="color: #990000">.</span>

hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Application basho_bench exited with reason<span style="color: #990000">:</span> stopped
hh<span style="color: #990000">:</span>mm<span style="color: #990000">:</span>ss<span style="color: #990000">.</span>sss <span style="color: #990000">[</span>info<span style="color: #990000">]</span> Test completed after <span style="color: #993399">1</span> mins<span style="color: #990000">.</span></tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
実行が終わると「Test completed」が出力されます。
</p>
</li>
<li>
<p>
実行を途中でキャンセルするなら、<tt>Control</tt> + <tt>c</tt> を押し、プロンプトに
  対して <tt>a</tt> を答えます。
</p>
</li>
</ul></div>
<div class="paragraph"><p>ワークロード（負荷）の設定ファイルの内容を確認しましょう。
<tt>less</tt> コマンドで「hibari-simple.config」ファイルの内容を表示します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ less hibari-simple<span style="color: #990000">.</span>config □</tt></pre></div></div>
<div class="paragraph"><p>hibari-simple.configの内容（抜粋）</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>

{mode, {rate, <span style="color: #993399">8</span>}}<span style="color: #990000">.</span>
{duration, <span style="color: #993399">15</span>}<span style="color: #990000">.</span>
{concurrent, <span style="color: #993399">100</span>}<span style="color: #990000">.</span>
{key<span style="color: #990000">_</span>generator, {int<span style="color: #990000">_</span>to<span style="color: #990000">_</span>bin, {uniform<span style="color: #990000">_</span>int, <span style="color: #993399">99000</span>}}}<span style="color: #990000">.</span>
{value<span style="color: #990000">_</span>generator, {fixed<span style="color: #990000">_</span>bin, <span style="color: #993399">1000</span>}}<span style="color: #990000">.</span>
{operations, [{<span style="font-weight: bold"><span style="color: #0000FF">get</span></span>,<span style="color: #993399">4</span>}, {<span style="font-weight: bold"><span style="color: #0000FF">put</span></span>,<span style="color: #993399">4</span>}, {delete, <span style="color: #993399">1</span>}]}<span style="color: #990000">.</span></tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
リクエストレートとワーカー？数の設定から、Basho Benchが生成する負荷
  の大きさを、リクエスト/秒で表してください。以下の式で求められます。
</p>
<div class="ulist"><ul>
<li>
<p>
リクエスト/秒　＝　ワーカー毎のリクエスト/秒　×　ワーカー数
</p>
</li>
</ul></div>
</li>
<li>
<p>
キーについて <strong>TODO</strong>
</p>
</li>
<li>
<p>
オペレーションについて <strong>TODO</strong>
</p>
</li>
</ul></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">補足 Basho Benchのキー設定</div>
<div class="exampleblock-content">
<div class="paragraph"><p>Basho Benchでは以下のようなキーの分散設定ができます。</p></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>{sequential_int, MaxKey}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
generates integers from 0..MaxKey in order and then stops the
    system. Note that each instance of this keygen is specific to a
    worker.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{partitioned_sequential_int, MaxKey}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
    worker processes. This is useful for pre-loading a large dataset.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{partitioned_sequential_int, StartKey, NumKeys}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
same as partitioned_sequential_int, but starting at the defined
    StartKey and going up to StartKey + NumKeys.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{uniform_int, MaxKey}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
selects an integer from uniform distribution of
    0..MaxKey. I.e. all integers are equally probable.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{pareto_int, MaxKey}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
selects an integer from a Pareto distribution, such that 20% of
    the available keys get selected 80% of the time. Note that the
    current implementation of this generator MAY yield values larger
    than MaxKey due to the mathematical properties of the Pareto
    distribution.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{truncated_pareto_int, MaxKey}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{function, Module, Function, Args}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
specifies an external function that should return a key generator
    function. The worker Id will be prepended to Args when the
    function is called.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{int_to_bin, Generator}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
takes any of the above _int generators and converts the number to
    a 32-bit binary. This is needed for some drivers that require a
    binary key.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{int_to_str, Generator}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
takes any of the above _int generators and converts the number to
    a string. This is needed for some drivers that require a string
    key.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div></div>
<div class="exampleblock">
<div class="title">補足 Basho Benchのバリュー設定</div>
<div class="exampleblock-content">
<div class="paragraph"><p>Basho Benchでは以下のようなバリューを生成できます。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>{fixed_bin, Size}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
generates a random binary of Size bytes. Every binary is the same
    size, but varies in content.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{exponential_bin, MinSize, Mean}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
generates a random binary which has an exponentially-distributed
    size. Most values will be approximately MinSize + Mean bytes in
    size, with a long-tail of larger values.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{uniform_bin, MinSize, MaxSize}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
generates a random binary which has an evenly-distributed size
    between MinSize and MaxSize.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>{function, Module, Function, Args}</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
specifies an external function that should return a value
    generator function. The worker Id will be prepended to Args when
    the function is called.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 7-4. グラフのプロット（R言語）と結果の確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>実行結果をグラフにプロットしてみましょう。Basho_Benchには統計解析プロ
グラミング言語の <strong>R言語</strong> で書かれたスクリプトが付属していますので、そ
れを利用してグラフを生成しましょう。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ bb-summary-ossforum<span style="color: #990000">.</span>sh □
<span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> 生成されたpingファイルを見る方法（Webブラウザーでアクセス）</tt></pre></div></div>
<div class="paragraph"><p>このグラフを見て、Hibariは書き込み（set）と読み出し（get）のどちらが得
意だと思いましたか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　
1. 書き込み（set）　　2. 読み出し（get）</p></div>
</div></div>
</div></div>
<div class="ulist NOTE"><div class="title">RiakやCassandraの特性</div><ul>
<li>
<p>
Cassandraは書き込みのほうが読み出しより得意です。
</p>
</li>
<li>
<p>
Riakは使用するストレージエンジンによって特性が異なります。
</p>
</li>
</ul></div>
<div class="exampleblock">
<div class="title">問題 7-5. キーに連番を使用した場合の分散状況</div>
<div class="exampleblock-content">
<div class="paragraph"><p>キーとして1〜100万まで数字を <strong>順番に</strong> 生成した時のリクエストの分散状況
を確認しましょう。テストをスタートし、チェイン毎に処理したリクエスト数
の増え方を、Web UIから観察します。</p></div>
<div class="paragraph"><p>Basho Benchを実行します。このテストは２分後で自動停止します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ basho_bench conf-bb/hibari-sequential<span style="color: #990000">.</span>config</tt></pre></div></div>
<div class="paragraph"><p>キーの設定は以下のようになってます。</p></div>
<div class="listingblock">
<div class="title">conf-bb/hibari-sequential.configのキー設定</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>{key<span style="color: #990000">_</span>generator, {int<span style="color: #990000">_</span>to<span style="color: #990000">_</span>bin, {sequential<span style="color: #990000">_</span>int, <span style="color: #993399">1000000</span>}}}<span style="color: #990000">.</span></tt></pre></div></div>
<div class="paragraph"><p>Basho BenchをスタートしたらすぐにHibariのWeb UIを開きます。</p></div>
<div class="paragraph"><p><a href="http://仮想サーバーのアドレス:23080/table?name=basho_bench_test_sequential">http://仮想サーバーのアドレス:23080/table?name=basho_bench_test_sequential</a></p></div>
<div class="paragraph"><p>Chainsの表の「Size」の数字を観察してください。どのように増えていきます
か？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　1. 全チェインに均等に分散している　　2. 一部のチェインに偏っている</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 7-6. キーにばらつきのある値を使用した場合の分散状況</div>
<div class="exampleblock-content">
<div class="paragraph"><p>キーとして1〜100万まで数字を <strong>ランダムに</strong> 生成した時のリクエストの分散
状況を確認しましょう。テストをスタートし、チェイン毎に処理したリクエス
ト数の増え方を、Web UIから観察します。</p></div>
<div class="paragraph"><p>Basho Benchを実行します。このテストは２分後で自動停止します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ basho_bench conf-bb/hibari-random<span style="color: #990000">.</span>config</tt></pre></div></div>
<div class="paragraph"><p>キーの設定は以下のようになってます。</p></div>
<div class="listingblock">
<div class="title">conf-bb/hibari-random.configのキー設定</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>{key<span style="color: #990000">_</span>generator, {int<span style="color: #990000">_</span>to<span style="color: #990000">_</span>bin, {uniform<span style="color: #990000">_</span>int, <span style="color: #993399">1000000</span>}}}<span style="color: #990000">.</span></tt></pre></div></div>
<div class="paragraph"><p>Basho BenchをスタートしてすぐにHibariのWeb UIを開きます。</p></div>
<div class="paragraph"><p><a href="http://仮想サーバーのアドレス:23080/table?name=basho_bench_test_random">http://仮想サーバーのアドレス:23080/table?name=basho_bench_test_random</a></p></div>
<div class="paragraph"><p>Chainsの表の「Size」の数字を観察してください。どのように増えていきます
か？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　1. 全チェインに均等に分散している　　2. 一部のチェインに偏っている</p></div>
</div></div>
</div></div>
<h3 id="_hibari_4">Hibariの停止</h3><div style="clear:left"></div>
<div class="paragraph"><p>作業が終わったらHibariを停止します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hibari-stop-ossforum<span style="color: #990000">.</span>sh □
ok
ok
<span style="color: #990000">...</span>（略）
hibari2 stopped
hibari1 stopped

$ hibari-ping-ossforum<span style="color: #990000">.</span>sh □
hibari1 <span style="color: #990000">...</span> Node <span style="color: #FF0000">'hibari1@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
node hibari1 ping failed
hibari2 <span style="color: #990000">...</span> Node <span style="color: #FF0000">'hibari2@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
node hibari2 ping failed
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">時間が余ったら</div>もし時間が余ったら、Basho BenchでRiakの性能も測ってみてください。</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ basho_bench conf-bb/riak-simple<span style="color: #990000">.</span>config □
$ basho_bench conf-bb/riak-sequential<span style="color: #990000">.</span>config □
$ basho_bench conf-bb/riak-random<span style="color: #990000">.</span>conf □</tt></pre></div></div>
</div>
<h2 id="_8_apache_hbase">8. Apache HBaseの基本操作</h2>
<div class="sectionbody">
<h3 id="_hbase">HBaseの特徴</h3><div style="clear:left"></div>
<div class="ulist"><ul>
<li>
<p>
自動シャーディングによるデータ分散
</p>
</li>
<li>
<p>
整合性を優先（CP）
</p>
<div class="ulist"><ul>
<li>
<p>
CAS操作
</p>
</li>
</ul></div>
</li>
<li>
<p>
ソート済みカラム指向型
</p>
</li>
<li>
<p>
Hadoopインフラ上で稼働
</p>
</li>
</ul></div>
<h3 id="_hbase_2">HBaseの起動と停止</h3><div style="clear:left"></div>
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="paragraph"><p>（構成図）</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> HDFSの擬似分散モードを使用する。

$ sudo service hbase-master status □
HBase is not running<span style="color: #990000">.</span>
$ sudo service hbase-master start □
starting master<span style="color: #990000">,</span> logging to /var/log/hbase/hbase-hbase-master-hostname<span style="color: #990000">.</span>domainname<span style="color: #990000">.</span>out
$ sudo service hbase-master status □
HBase is running

<span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> local-regionservers<span style="color: #990000">.</span>sh</tt></pre></div></div>
<h3 id="_hbase_api">HBaseのクライアントAPI</h3><div style="clear:left"></div>
<div class="paragraph"><p>HBaseでは３種類のクライアントAPIが用意されています。</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Javaネイティブクライアント</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
プログラミング言語「Java」専用のクライアント
</p>
</li>
<li>
<p>
HBaseはJavaで書かれています
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Thrift</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
様々なプログラミング言語からアクセスできる
</p>
</li>
<li>
<p>
ウェブブラウザーで表示できる
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>また、HBaseシェル&#8230; <strong>TODO</strong></p></div>
<h3 id="_hbase_3">HBaseシェルでアクセス</h3><div style="clear:left"></div>
<h4 id="__10">テーブルを作成</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hbase-create-tables-ossforum<span style="color: #990000">.</span>sh □
<span style="color: #990000">*</span>TODO<span style="color: #990000">*</span></tt></pre></div></div>
<div class="paragraph"><p>このスクリプトにより「ycsb_test」というテーブルが作られました。</p></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h4 id="_hbase_4">HBaseに接続</h4>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hbase shell
WARN conf<span style="color: #990000">.</span>Configuration<span style="color: #990000">:</span> hadoop<span style="color: #990000">.</span>native<span style="color: #990000">.</span>lib is deprecated<span style="color: #990000">.</span> Instead<span style="color: #990000">,</span> use io<span style="color: #990000">.</span>native<span style="color: #990000">.</span>lib<span style="color: #990000">.</span>available
HBase Shell<span style="color: #990000">;</span> enter <span style="color: #FF0000">'help&lt;RETURN&gt;'</span> <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> list of supported commands<span style="color: #990000">.</span>
Type <span style="color: #FF0000">"exit&lt;RETURN&gt;"</span> to leave the HBase Shell
Version <span style="color: #993399">0.92</span><span style="color: #990000">.</span><span style="color: #993399">1</span>-cdh<span style="color: #993399">4.0</span><span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">,</span> rUnknown<span style="color: #990000">,</span> Thu Jun <span style="color: #993399">28</span> <span style="color: #993399">18</span><span style="color: #990000">:</span><span style="color: #993399">09</span><span style="color: #990000">:</span><span style="color: #993399">40</span> PDT <span style="color: #993399">2012</span>

hbase<span style="color: #990000">(</span>main<span style="color: #990000">):</span><span style="color: #993399">001</span><span style="color: #990000">:</span><span style="color: #993399">0</span><span style="color: #990000">&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>以下、プロンプト「hbase(main):001:0&gt;」は「hbase&gt;」で示します。</p></div>
<h4 id="__11">カラムを格納</h4>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h4 id="__12">レンジスキャン</h4>
<div class="paragraph"><p><strong>TODO</strong></p></div>
</div>
<h2 id="_9">9. データ分散について：自動シャーディング（その１）</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="title">問題 9-1. クラスター構成の確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>このHBaseクラスターにはリージョンサーバーが１つだけ稼働しています。</p></div>
<div class="paragraph"><p>以下のHBaseシェルコマンドで確認してください。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>hbase<span style="color: #990000">&gt;</span> status <span style="color: #FF0000">'simple'</span> □
<span style="color: #993399">1</span> live servers
    hostname<span style="color: #990000">.</span>domainname<span style="color: #990000">:</span><span style="color: #993399">41932</span> <span style="color: #993399">1348176548890</span>
        requestsPerSecond<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">,</span> numberOfOnlineRegions<span style="color: #990000">=</span><span style="color: #993399">5</span><span style="color: #990000">,</span> usedHeapMB<span style="color: #990000">=</span><span style="color: #993399">29</span><span style="color: #990000">,</span> maxHeapMB<span style="color: #990000">=</span><span style="color: #993399">991</span>
<span style="color: #993399">0</span> dead servers
Aggregate <span style="font-weight: bold"><span style="color: #0000FF">load</span></span><span style="color: #990000">:</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> regions<span style="color: #990000">:</span> <span style="color: #993399">5</span></tt></pre></div></div>
<div class="paragraph"><p>「1 live servers」と表示されていればOKです。</p></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-2. リージョン数の確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>テーブル「ycsb_test」にはいくつのリージョンがありますか？　Web UIで調
べてください。</p></div>
<div class="paragraph"><p><a href="http://仮想サーバーのアドレス:60010/">http://仮想サーバーのアドレス:60010/</a></p></div>
<div class="paragraph"><p>●●のリンクをクリックし、●●●ページが開いたら「●●●」を見ます。</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　　　　　　　　　個　</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-3. リージョンのスタートキー、エンドキーの確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p>先ほどのWeb UIでは、それぞれのリージョンについて「Start Key」と「End
Key」が表示されていました。RiakやHibariでは「キーのハッシュ値」が使わ
れていましたが、HBaseではどのような値が使用されていますか？　Web UIで
調べてください。</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え： 1. キーのハッシュ値　　2. キーの値そのもの</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-4. YCSBの実行</div>
<div class="exampleblock-content">
<div class="paragraph"><p>YCSBを実行しましょう。以下のコマンドを入力します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd <span style="color: #990000">~</span>/hands-on □
$ ycsb run hbase -P conf-ycsb/hbase-simple<span style="color: #990000">.</span>properties -s -threads <span style="color: #993399">10</span> -target <span style="color: #993399">5000</span> □
<span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> （出力メッセージ）</tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
実行が終わると●●●●が出力されます。
</p>
</li>
<li>
<p>
実行を途中でキャンセルするなら、<tt>Control</tt> + <tt>c</tt> を押します。
</p>
</li>
</ul></div>
<div class="paragraph"><p>ワークロード（負荷）の設定ファイルの内容を確認しましょう。
<tt>less</tt> コマンドで「hbase-simple.properties」ファイルの内容を表示します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ less hbase-simple<span style="color: #990000">.</span>properties □</tt></pre></div></div>
<div class="listingblock">
<div class="title">hbase-simple.propertiesの内容（抜粋）</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">recordcount</span><span style="color: #990000">=</span>1000000
<span style="color: #009900">operationcount</span><span style="color: #990000">=</span>5000000
<span style="color: #009900">workload</span><span style="color: #990000">=</span>com.yahoo.ycsb.workloads.CoreWorkload

<span style="color: #009900">readallfields</span><span style="color: #990000">=</span>false

<span style="color: #009900">readproportion</span><span style="color: #990000">=</span>0.50
<span style="color: #009900">updateproportion</span><span style="color: #990000">=</span>0.15
<span style="color: #009900">scanproportion</span><span style="color: #990000">=</span>0
<span style="color: #009900">insertproportion</span><span style="color: #990000">=</span>0.35

<span style="color: #009900">requestdistribution</span><span style="color: #990000">=</span>zipfian

<span style="color: #009900">table</span><span style="color: #990000">=</span>ycsb-test
<span style="color: #009900">columnfamily</span><span style="color: #990000">=</span>cf</tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
リクエストレートとワーカー？数の設定から、YCSBが生成する負荷
  の大きさを、リクエスト/秒で表してください。以下の式で求められます。
</p>
<div class="ulist"><ul>
<li>
<p>
リクエスト/秒　＝　ワーカー毎のリクエスト/秒　×　ワーカー数
</p>
</li>
</ul></div>
</li>
<li>
<p>
キーの生成について　<strong>TODO</strong>
</p>
</li>
<li>
<p>
<strong>TODO</strong>
</p>
</li>
</ul></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-5. 結果の確認</div>
<div class="exampleblock-content">
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> □</tt></pre></div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-6. キーに連番を使用した場合の分散状況</div>
<div class="exampleblock-content">
<div class="paragraph"><p>キーとして1〜100万まで数字を <strong>順番に</strong> 生成した時のリクエストの分散状況
を確認しましょう。テストをスタートし、チェイン毎に処理したリクエスト数
の増え方を、Web UIから観察します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ ycsb conf-ycsb/hbase-sequential<span style="color: #990000">.</span>properties</tt></pre></div></div>
<div class="paragraph"><p>キーの設定は以下のようになってます。</p></div>
<div class="listingblock">
<div class="title">conf-ycsb/hbase-sequential.propertiesのキー設定</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">requestdistribution</span><span style="color: #990000">=</span>xxxxxxxx // *TODO*</tt></pre></div></div>
<div class="paragraph"><p>YCSBをスタートしたらすぐにHBaseのWeb UIを開きます。</p></div>
<div class="paragraph"><p>http:// &#8230;</p></div>
<div class="paragraph"><p>●●●の数字を観察してください。どのように増えていきますか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　1. 全リージョンに均等に分散している　　2. 一部のリージョンに偏っている</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-7. キーにばらつきのある値を使用した場合の分散状況</div>
<div class="exampleblock-content">
<div class="paragraph"><p>キーとして1〜100万まで数字を <strong>ランダムに</strong> 生成した時のリクエストの分散
状況を確認しましょう。テストをスタートし、チェイン毎に処理したリクエス
ト数の増え方を、Web UIから観察します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ ycsb conf-ycsb/hbase-random<span style="color: #990000">.</span>properties</tt></pre></div></div>
<div class="paragraph"><p>キーの設定は以下のようになってます。</p></div>
<div class="listingblock">
<div class="title">conf-ycsb/hbase-random.propertiesのキー設定</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">requestdistribution</span><span style="color: #990000">=</span>xxxxxxxx // *TODO*</tt></pre></div></div>
<div class="paragraph"><p>YCSBをスタートしたらすぐにHBaseのWeb UIを開きます。</p></div>
<div class="paragraph"><p>http:// &#8230;</p></div>
<div class="paragraph"><p>●●●の数字を観察してください。どのように増えていきますか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　1. 全リージョンに均等に分散している　　2. 一部のリージョンに偏っている</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 9-8. リージョンが分割されていく様子の観察</div>
<div class="exampleblock-content">
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="paragraph"><p>以下のコマンドで調べてください。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> □</tt></pre></div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　</p></div>
</div></div>
</div></div>
<h3 id="_hbase_5">HBaseの停止</h3><div style="clear:left"></div>
<div class="paragraph"><p>作業が終わったらHBaseを停止します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ sudo service hbase-master stop □
stopping master<span style="color: #990000">....</span>
$ sudo service hbase-master status □
HBase is not running<span style="color: #990000">.</span></tt></pre></div></div>
</div>
<h2 id="_xx">XX. 講義：コンシステントハッシングと自動シャーディングの優劣の比較</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>TODO</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
データの分散（分布）の均一性
</p>
</li>
<li>
<p>
レンジスキャンの可否
</p>
</li>
</ul></div>
</div>
<h2 id="_10_ap_nosql">10. 可用性重視（AP）のNOSQLの挙動</h2>
<div class="sectionbody">
<div class="paragraph"><p>Riakを使用して可用性重視（AP型）のNOSQLの挙動を確認しましょう。メンバー
ノードを１つ停止して、読み出しと書き込みの動作を調べます。</p></div>
<div class="paragraph"><p>Riakの環境を初期化しましょう。この操作により今までRiakに保存したデータ
は全て削除されます。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>（Riakの停止。すでに停止しているのでエラーになります）
$ riak-stop-ossforum<span style="color: #990000">.</span>sh □
Node <span style="color: #FF0000">'riak1@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
Node <span style="color: #FF0000">'riak2@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
<span style="color: #990000">...</span>（略）
node riak1 stop failed
node riak2 stop failed
<span style="color: #990000">...</span>（略<span style="color: #990000">)</span>

（Riakのデータを全て削除します）
$ riak-reset-ossforum<span style="color: #990000">.</span>sh □
deleted data on riak1
deleted data on riak2
<span style="color: #990000">...</span>（略<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Riakを起動します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-start-ossforum<span style="color: #990000">.</span>sh □
riak1 started
riak2 started
<span style="color: #990000">...</span>（略）

$ riak-ping-ossforum<span style="color: #990000">.</span>sh □
riak1 <span style="color: #990000">...</span> pong
riak2 <span style="color: #990000">...</span> pong
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
<div class="paragraph"><p>Riakクラスターを組み直します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-build-cluster<span style="color: #990000">.</span>sh □
Success<span style="color: #990000">:</span> staged join request <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">'riak2@127.0.0.1'</span> to <span style="color: #FF0000">'riak1@127.0.0.1'</span>
Success<span style="color: #990000">:</span> staged join request <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">'riak3@127.0.0.1'</span> to <span style="color: #FF0000">'riak1@127.0.0.1'</span>
 <span style="color: #990000">===============================</span> Staged Changes <span style="color: #990000">================================</span>
 Action         Nodes<span style="color: #990000">(</span>s<span style="color: #990000">)</span>
 -------------------------------------------------------------------------------
 join           <span style="color: #FF0000">'riak2@127.0.0.1'</span>
 join           <span style="color: #FF0000">'riak3@127.0.0.1'</span>
 -------------------------------------------------------------------------------


 NOTE<span style="color: #990000">:</span> Applying these changes will result <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="color: #993399">1</span> cluster transition

 <span style="font-style: italic"><span style="color: #9A1900">###############################################################################</span></span>
                         After cluster transition <span style="color: #993399">1</span><span style="color: #990000">/</span><span style="color: #993399">1</span>
 <span style="font-style: italic"><span style="color: #9A1900">###############################################################################</span></span>

 <span style="color: #990000">=================================</span> Membership <span style="color: #990000">==================================</span>
 Status     Ring    Pending    Node
 -------------------------------------------------------------------------------
 valid     <span style="color: #993399">100.0</span><span style="color: #990000">%</span>     <span style="color: #993399">50.0</span><span style="color: #990000">%</span>    <span style="color: #FF0000">'riak1@127.0.0.1'</span>
 valid       <span style="color: #993399">0.0</span><span style="color: #990000">%</span>     <span style="color: #993399">25.0</span><span style="color: #990000">%</span>    <span style="color: #FF0000">'riak2@127.0.0.1'</span>
 valid       <span style="color: #993399">0.0</span><span style="color: #990000">%</span>     <span style="color: #993399">25.0</span><span style="color: #990000">%</span>    <span style="color: #FF0000">'riak3@127.0.0.1'</span>
 -------------------------------------------------------------------------------
 Valid<span style="color: #990000">:</span><span style="color: #993399">3</span> <span style="color: #990000">/</span> Leaving<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Exiting<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Joining<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Down<span style="color: #990000">:</span><span style="color: #993399">0</span>

 WARNING<span style="color: #990000">:</span> Not all replicas will be on distinct nodes

 Transfers resulting from cluster changes<span style="color: #990000">:</span> <span style="color: #993399">4</span>
   <span style="color: #993399">2</span> transfers from <span style="color: #FF0000">'riak1@127.0.0.1'</span> to <span style="color: #FF0000">'riak3@127.0.0.1'</span>
   <span style="color: #993399">2</span> transfers from <span style="color: #FF0000">'riak1@127.0.0.1'</span> to <span style="color: #FF0000">'riak2@127.0.0.1'</span>

 Cluster changes committed
 <span style="color: #990000">=================================</span> Membership <span style="color: #990000">==================================</span>
 Status     Ring    Pending    Node
 -------------------------------------------------------------------------------
 valid      <span style="color: #993399">50.0</span><span style="color: #990000">%</span>      --      <span style="color: #FF0000">'riak1@127.0.0.1'</span>
 valid      <span style="color: #993399">25.0</span><span style="color: #990000">%</span>      --      <span style="color: #FF0000">'riak2@127.0.0.1'</span>
 valid      <span style="color: #993399">25.0</span><span style="color: #990000">%</span>      --      <span style="color: #FF0000">'riak3@127.0.0.1'</span>
 -------------------------------------------------------------------------------
 Valid<span style="color: #990000">:</span><span style="color: #993399">3</span> <span style="color: #990000">/</span> Leaving<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Exiting<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Joining<span style="color: #990000">:</span><span style="color: #993399">0</span> <span style="color: #990000">/</span> Down<span style="color: #990000">:</span><span style="color: #993399">0</span></tt></pre></div></div>
<div class="exampleblock">
<div class="title">問題 10-1. １ノードダウン時の読み出し操作</div>
<div class="exampleblock-content">
<div class="paragraph"><p>メンバーノードの１つが停止しているときの読み出しの挙動を確認しましょう。
まず、全ノードが稼働している状態で書き込みを行い、次に、メンバーノード
の１つを停止します。</p></div>
<div class="paragraph"><p>sshターミナルのウィンドウを２つ開いてください。一方はErlangシェル、も
う一方はLinuxシェル（bash）を動かしましょう。</p></div>
<div class="paragraph"><p>２つのウィンドウを開いたら、以下のコマンドを実行します。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">put</span></span>(w<span style="color: #990000">=</span>all)</tt></pre></div></div>
<div class="paragraph"><p>オブジェクトを書き込んだらメンバーノードの１つを停止します。</p></div>
<div class="listingblock">
<div class="title">bash用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #009900">$RIAK_HOME</span>/riak<span style="color: #993399">3</span>/bin/riak stop □
$ <span style="color: #009900">$RIAK_HOME</span>/riak<span style="color: #993399">3</span>/bin/riak ping □
Node <span style="color: #FF0000">'riak3@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
$ riak-admin member_status
<span style="color: #990000">*</span>TODO<span style="color: #990000">*</span></tt></pre></div></div>
<div class="paragraph"><p>R = quorumでの読み出を試みます。もし読み出しに失敗した場合は
「key_notfound」が返されます。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">get</span></span>(r<span style="color: #990000">=</span>quorum)</tt></pre></div></div>
<div class="paragraph"><p>R = allでの読み出を試みます。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">get</span></span>(r<span style="color: #990000">=</span>all)</tt></pre></div></div>
<div class="paragraph"><p>読み出しは成功しましたか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：<br />
R = quorumの時　　1. 成功　　　2. 失敗<br />
R = allの時　　　　1. 成功　　　2. 失敗</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 10-2. １ノードダウン時の書き込み操作</div>
<div class="exampleblock-content">
<div class="paragraph"><p>メンバーノードの１つが停止したまま書き込みの挙動を確認しましょう。</p></div>
<div class="paragraph"><p>W = quorumで書き込みを試みます。もし書き込みに失敗した場合は
「●●●●」が返されます。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">put</span></span>(w<span style="color: #990000">=</span>quorum)</tt></pre></div></div>
<div class="paragraph"><p>W = allでの書き込みを試みます。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">put</span></span>(W<span style="color: #990000">=</span>all)</tt></pre></div></div>
<div class="paragraph"><p>書き込みは成功しましたか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：<br />
W = quorumの時　　1. 成功　　　2. 失敗<br />
W = allの時　　　　1. 成功　　　2. 失敗</p></div>
</div></div>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Cassandraでの書き込み</div>CassandraではW = allの時に書き込みが失敗します。</td>
</tr></table>
</div>
<h3 id="_riak_5">Riakの停止</h3><div style="clear:left"></div>
<div class="paragraph"><p>作業が終わったらRiakを停止します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ riak-stop-ossforum<span style="color: #990000">.</span>sh □
ok
ok
<span style="color: #990000">...</span>（略）
riak2 stopped
riak1 stopped

$ riak-ping-ossforum<span style="color: #990000">.</span>sh □
riak1 <span style="color: #990000">...</span> Node <span style="color: #FF0000">'riak1@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
node riak1 ping failed
riak2 <span style="color: #990000">...</span> Node <span style="color: #FF0000">'riak2@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
node riak2 ping failed
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
</div>
<h2 id="_xx_hinted_hand_off">XX. 講義：Hinted Hand-offとリードリペア</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>TODO</strong></p></div>
</div>
<h2 id="_11_cp_nosql">11. 整合性重視（CP）のNOSQLの挙動</h2>
<div class="sectionbody">
<div class="paragraph"><p>Hibariを使用して整合性重視（CP型）のNOSQLの挙動を確認しましょう。ブリッ
クサーバーを１つ停止して、読み出しと書き込みの動作を調べます。</p></div>
<div class="paragraph"><p>Hibariの環境を初期化しましょう。この操作により今までHibariに保存したデー
タは全て削除されます。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>（Hibariの停止。すでに停止しているのでエラーになります）
$ hibari-stop-ossforum<span style="color: #990000">.</span>sh □
Node <span style="color: #FF0000">'hibari1@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
Node <span style="color: #FF0000">'hibari2@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span>
<span style="color: #990000">...</span>（略）
node hibari1 stop failed
node hibari2 stop failed
<span style="color: #990000">...</span>（略<span style="color: #990000">)</span>

（Hibariのデータを全て削除します）
$ riak-reset-ossforum<span style="color: #990000">.</span>sh □
deleted data on hibari1
deleted data on hibari2
<span style="color: #990000">...</span>（略<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Hibariを起動します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hibari-start-ossforum<span style="color: #990000">.</span>sh □
hibari1 started
hibari2 started
<span style="color: #990000">...</span>（略）

$ hibari-ping-ossforum<span style="color: #990000">.</span>sh □
hibari1 <span style="color: #990000">...</span> pong
hibari2 <span style="color: #990000">...</span> pong
<span style="color: #990000">...</span>（略）</tt></pre></div></div>
<div class="paragraph"><p>テーブルを再作成します。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ hibari-create-tables-ossforum<span style="color: #990000">.</span>sh □
$ hibari-create-tables-ossforum<span style="color: #990000">.</span>sh □
ok
ok
Table basho_bench_test_simple created
ok
Table basho_bench_test_sequential created
ok
Table basho_bench_test_random created</tt></pre></div></div>
<div class="exampleblock">
<div class="title">問題 11-1. １ノードダウン時の読み出し操作</div>
<div class="exampleblock-content">
<div class="paragraph"><p>ブリックサーバーの１つが停止しているときの読み出しの挙動を確認しましょ
う。まず、全ノードが稼働している状態で書き込みを行い、次に、ブリックサー
バーの１つを停止します。</p></div>
<div class="paragraph"><p>sshターミナルのウィンドウを２つ開いてください。一方はErlangシェル、も
う一方はLinuxシェル（bash）を動かしましょう。</p></div>
<div class="paragraph"><p>２つのウィンドウを開いたら、以下のコマンドを実行します。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  キー・バリューの<span style="font-weight: bold"><span style="color: #0000FF">put</span></span></tt></pre></div></div>
<div class="paragraph"><p>キー・バリューを書き込んだらブリックサーバーの１つを停止します。</p></div>
<div class="listingblock">
<div class="title">bash用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #009900">$HIBARI_HOME</span>/hibari<span style="color: #993399">3</span>/bin/hibari stop □
$ <span style="color: #009900">$HIBARI_HOME</span>/hibari<span style="color: #993399">3</span>/bin/hibari ping □
Node <span style="color: #FF0000">'hibari3@127.0.0.1'</span> not responding to pings<span style="color: #990000">.</span></tt></pre></div></div>
<div class="paragraph"><p>Web UIでチェインの状態が「degrated」になっていることを確認してください。</p></div>
<div class="paragraph"><p><a href="http://仮想サーバーのアドレス:23080/">http://仮想サーバーのアドレス:23080/</a></p></div>
<div class="paragraph"><p>●●の欄を見ます。</p></div>
<div class="paragraph"><p>読み出を試みます。もし読み出しに失敗した場合は「brick_not_available」
が返されます。なおHibariでは読み出しはR＝1に固定されています。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">get</span></span></tt></pre></div></div>
<div class="paragraph"><p>読み出しは成功しましたか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　1. 成功　　　2. 失敗</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 11-2. １ノードダウン時の書き込み操作</div>
<div class="exampleblock-content">
<div class="paragraph"><p>ブリックサーバーの１つが停止したまま書き込みの挙動を確認しましょう。</p></div>
<div class="paragraph"><p>書き込みを試みます。もし書き込みに失敗した場合は「brick_not_available」
が返されます。</p></div>
<div class="listingblock">
<div class="title">Erlangシェル用ウィンドウ</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">*</span>TODO<span style="color: #990000">*</span>  オブジェクトの<span style="font-weight: bold"><span style="color: #0000FF">put</span></span></tt></pre></div></div>
<div class="paragraph"><p>書き込みは成功しましたか？</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：　　　　1. 成功　　　2. 失敗</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 11-3. CAS操作</div>
<div class="exampleblock-content">
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> □</tt></pre></div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 11-4. Hibariのマイクロトランザクション</div>
<div class="exampleblock-content">
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> □</tt></pre></div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：</p></div>
</div></div>
</div></div>
</div>
<h2 id="_xx_ap_cp">XX. 講義：APとCPの違いのまとめ</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>TODO</strong></p></div>
</div>
<h2 id="_12_lsmtree">12. ログ構造マージツリー（LSMTree）の特性</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="title">問題 12-1. 書き込みを繰り返した時の読み出し性能の劣化</div>
<div class="exampleblock-content">
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> □</tt></pre></div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：</p></div>
</div></div>
</div></div>
<div class="exampleblock">
<div class="title">問題 12-2. メジャーコンパクション後の性能の回復</div>
<div class="exampleblock-content">
<div class="paragraph"><p><strong>TODO</strong><br /></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">*</span>TODO<span style="color: #990000">*</span> □</tt></pre></div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>答え：</p></div>
</div></div>
</div></div>
</div>
<h2 id="_13_hbase">13. グループワーク：HBaseクラスターのセットアップ</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>TODO</strong></p></div>
</div>
<h2 id="_xx_2">XX. 後片付け</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h3 id="__13">仮想サーバーの停止、削除</h3><div style="clear:left"></div>
</div>
<h2 id="_xx_3">XX. 参考資料</h2>
<div class="sectionbody">
<h3 id="_basho_riak">Basho Riak</h3><div style="clear:left"></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h3 id="_apache_hbase">Apache HBase</h3><div style="clear:left"></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
<h3 id="_hibari_5">Hibari</h3><div style="clear:left"></div>
<div class="paragraph"><p><strong>TODO</strong></p></div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.0-draft-2<br />
Last updated 2012-09-24 15:25:26 JST
</div>
</div>
</body>
</html>
